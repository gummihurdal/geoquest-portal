import{j as P,C as O}from"./index-BtPTFesg.js";import{b as L}from"./router-VMO5LVTi.js";import{W as V,S as q,P as H,G as B,d as W,e as U,f as Z,g as _,b as j,a as E,M as R,B as J,A as K,h as I,T as Q,C as D,E as ee,L as te,i as ne,V as re}from"./three-B9sUftFy.js";function oe(n){return n}function se(n){if(n==null)return oe;var o,s,i=n.scale[0],c=n.scale[1],f=n.translate[0],b=n.translate[1];return function(x,v){v||(o=s=0);var y=2,e=x.length,t=new Array(e);for(t[0]=(o+=x[0])*i+f,t[1]=(s+=x[1])*c+b;y<e;)t[y]=x[y],++y;return t}}function ae(n,o){for(var s,i=n.length,c=i-o;c<--i;)s=n[c],n[c++]=n[i],n[i]=s}function ie(n,o){return typeof o=="string"&&(o=n.objects[o]),o.type==="GeometryCollection"?{type:"FeatureCollection",features:o.geometries.map(function(s){return $(n,s)})}:$(n,o)}function $(n,o){var s=o.id,i=o.bbox,c=o.properties==null?{}:o.properties,f=ce(n,o);return s==null&&i==null?{type:"Feature",properties:c,geometry:f}:i==null?{type:"Feature",id:s,properties:c,geometry:f}:{type:"Feature",id:s,bbox:i,properties:c,geometry:f}}function ce(n,o){var s=se(n.transform),i=n.arcs;function c(e,t){t.length&&t.pop();for(var a=i[e<0?~e:e],u=0,h=a.length;u<h;++u)t.push(s(a[u],u));e<0&&ae(t,h)}function f(e){return s(e)}function b(e){for(var t=[],a=0,u=e.length;a<u;++a)c(e[a],t);return t.length<2&&t.push(t[0]),t}function x(e){for(var t=b(e);t.length<4;)t.push(t[0]);return t}function v(e){return e.map(x)}function y(e){var t=e.type,a;switch(t){case"GeometryCollection":return{type:t,geometries:e.geometries.map(y)};case"Point":a=f(e.coordinates);break;case"MultiPoint":a=e.coordinates.map(f);break;case"LineString":a=b(e.arcs);break;case"MultiLineString":a=e.arcs.map(b);break;case"Polygon":a=v(e.arcs);break;case"MultiPolygon":a=e.arcs.map(v);break;default:return null}return{type:t,coordinates:a}}return y(o)}function N(n,o,s=1){const i=(90-n)*Math.PI/180,c=(o+180)*Math.PI/180;return new re(-(s*Math.sin(i)*Math.cos(c)),s*Math.cos(i),s*Math.sin(i)*Math.sin(c))}function ue(n,o,s,i=1.003){var b,x;const c=[],f=((b=n.geometry)==null?void 0:b.type)==="Polygon"?[n.geometry.coordinates]:((x=n.geometry)==null?void 0:x.type)==="MultiPolygon"?n.geometry.coordinates:[];for(const v of f)for(const y of v){const e=y.map(([a,u])=>N(u,a,i));if(e.length<2)continue;const t=new W().setFromPoints(e);c.push(new te(t,new ne({color:new D(o),transparent:!0,opacity:s})))}return c}function fe({onContinentClick:n}){const o=L.useRef(null),s=L.useRef({drag:!1,px:0,py:0,rotX:.3,rotY:1.2,vx:0,vy:0}),i=L.useRef({}),c=L.useRef(0),[f,b]=L.useState([]),[x,v]=L.useState(!1);L.useEffect(()=>{const e=o.current;if(!e)return;let t=!1;const a=new ResizeObserver(u=>{const{width:h,height:m}=u[0].contentRect;if(!(!h||!m))if(!t)t=!0,y(e,h,m),v(!0);else{const{renderer:M,camera:p}=i.current;M&&p&&(p.aspect=h/m,p.updateProjectionMatrix(),M.setSize(h,m))}});return a.observe(e),()=>{var u;a.disconnect(),cancelAnimationFrame(c.current),(u=i.current.renderer)==null||u.dispose()}},[]);function y(e,t,a){const u=document.createElement("canvas");u.style.cssText="position:absolute;top:0;left:0;width:100%;height:100%;display:block;",e.appendChild(u);const h=new V({canvas:u,antialias:!0,alpha:!0});h.setPixelRatio(Math.min(window.devicePixelRatio,2)),h.setSize(t,a);const m=new q,M=new H(42,t/a,.1,100);M.position.z=2.7;const p=new B;m.add(p),i.current={renderer:h,camera:M,group:p};const S=[];for(let r=0;r<3e3;r++)S.push((Math.random()-.5)*80,(Math.random()-.5)*80,(Math.random()-.5)*80);const k=new W;k.setAttribute("position",new U(new Float32Array(S),3)),m.add(new Z(k,new _({color:16777215,size:.06,transparent:!0,opacity:.55}))),m.add(new j(new E(1.22,64,64),new R({color:17510,transparent:!0,opacity:.09,side:J}))),m.add(new K(16777215,.9));const C=new I(16776672,1.1);C.position.set(5,3,5),m.add(C);const z=new I(2250154,.2);z.position.set(-5,-2,-3),m.add(z),new Q().load("/textures/earth.jpg",r=>p.add(new j(new E(1,64,64),new R({map:r,specular:new D(1118481),shininess:5}))),void 0,()=>p.add(new j(new E(1,64,64),new R({color:1789722})))),fetch("/textures/countries-110m.json").then(r=>r.json()).then(r=>{const d=ie(r,r.objects.countries),l=new B;p.add(l),d.features.forEach(g=>{ue(g,"#00ffff",.5).forEach(w=>l.add(w))})});const G=r=>{const d=e.getBoundingClientRect(),l="touches"in r?r.touches[0]:r;return{x:l.clientX-d.left,y:l.clientY-d.top}},F=r=>{const d=G(r);Object.assign(s.current,{drag:!0,px:d.x,py:d.y,vx:0,vy:0})},T=r=>{if(!s.current.drag)return;const d=G(r),l=s.current,g=d.x-l.px,w=d.y-l.py;l.vx=g*.007,l.vy=w*.005,l.rotY+=g*.007,l.rotX=Math.max(-1.3,Math.min(1.3,l.rotX+w*.005)),l.px=d.x,l.py=d.y},X=()=>{s.current.drag=!1};e.addEventListener("mousedown",F),window.addEventListener("mousemove",T),window.addEventListener("mouseup",X),e.addEventListener("touchstart",F,{passive:!0}),e.addEventListener("touchmove",T,{passive:!1}),e.addEventListener("touchend",X),e.style.cursor="grab",e.addEventListener("mousedown",()=>e.style.cursor="grabbing"),e.addEventListener("mouseup",()=>e.style.cursor="grab");const A=()=>{c.current=requestAnimationFrame(A);const r=s.current;r.drag||(Math.abs(r.vx)>2e-4||Math.abs(r.vy)>2e-4?(r.rotY+=r.vx,r.rotX=Math.max(-1.3,Math.min(1.3,r.rotX+r.vy)),r.vx*=.93,r.vy*=.93):r.rotY+=8e-4),p.rotation.y=r.rotY,p.rotation.x=r.rotX,h.render(m,M);const d=e.offsetWidth||t,l=e.offsetHeight||a;b(O.map(g=>{const w=N(g.labelLat,g.labelLon,1);w.applyEuler(new ee(p.rotation.x,p.rotation.y,0,"YXZ"));const Y=w.clone().project(M);return{id:g.id,name:g.name,emoji:g.emoji,color:g.color,x:(Y.x+1)/2*d,y:(-Y.y+1)/2*l,visible:w.z>.15}}))};A()}return P.jsxs("div",{ref:o,style:{position:"absolute",inset:0,background:"#00040e",overflow:"hidden"},children:[f.map(e=>e.visible&&P.jsx("button",{onClick:t=>{t.stopPropagation(),n(e.id)},onMouseDown:t=>t.stopPropagation(),style:{position:"absolute",left:e.x,top:e.y,transform:"translate(-50%,-50%)",zIndex:10,border:"none",background:"none",padding:0,cursor:"pointer"},children:P.jsxs("div",{style:{padding:"5px 13px",borderRadius:999,fontWeight:900,fontSize:13,whiteSpace:"nowrap",background:`${e.color}22`,border:`1.5px solid ${e.color}aa`,color:e.color,textShadow:`0 0 14px ${e.color},0 2px 4px rgba(0,0,0,0.9)`,boxShadow:`0 0 20px ${e.color}44,0 4px 12px rgba(0,0,0,0.6)`,backdropFilter:"blur(4px)",transition:"transform .15s"},onMouseEnter:t=>t.currentTarget.style.transform="scale(1.12)",onMouseLeave:t=>t.currentTarget.style.transform="scale(1)",children:[e.emoji," ",e.name]})},e.id)),P.jsx("div",{style:{position:"absolute",bottom:12,left:16,fontSize:11,color:"rgba(255,255,255,0.28)",pointerEvents:"none",userSelect:"none"},children:"ðŸ–± Drag to spin Â· Click a continent to play"})]})}export{fe as default};
