import{f as N,j as b,C as O}from"./index-Bkpxtwwm.js";import{b as y}from"./router-D8a8Cqz7.js";import{W as V,b as q,P as H,G as F,B as W,c as U,d as Z,e as _,M as j,f as P,g as R,h as J,A as K,i as I,T as Q,C as $,E as ee,L as te,j as oe,k as ne}from"./three-BMNwc1xD.js";function D(p,w,i=1){const u=(90-p)*Math.PI/180,f=(w+180)*Math.PI/180;return new ne(-(i*Math.sin(u)*Math.cos(f)),i*Math.cos(u),i*Math.sin(u)*Math.sin(f))}function se(p,w,i,u=1.003){var g,M;const f=[],v=((g=p.geometry)==null?void 0:g.type)==="Polygon"?[p.geometry.coordinates]:((M=p.geometry)==null?void 0:M.type)==="MultiPolygon"?p.geometry.coordinates:[];for(const L of v)for(const E of L){const e=E.map(([h,d])=>D(d,h,u));if(e.length<2)continue;const n=new W().setFromPoints(e);f.push(new te(n,new oe({color:new $(w),transparent:!0,opacity:i})))}return f}function ce({onContinentClick:p}){const w=y.useRef(null),i=y.useRef({drag:!1,px:0,py:0,rotX:.3,rotY:1.2,vx:0,vy:0}),u=y.useRef({}),f=y.useRef(0),[v,g]=y.useState([]),[M,L]=y.useState(!1);y.useEffect(()=>{const e=w.current;if(!e)return;let n=!1;const h=new ResizeObserver(d=>{const{width:l,height:a}=d[0].contentRect;if(!(!l||!a))if(!n)n=!0,E(e,l,a),L(!0);else{const{renderer:x,camera:r}=u.current;x&&r&&(r.aspect=l/a,r.updateProjectionMatrix(),x.setSize(l,a))}});return h.observe(e),()=>{var d;h.disconnect(),cancelAnimationFrame(f.current),(d=u.current.renderer)==null||d.dispose()}},[]);function E(e,n,h){const d=document.createElement("canvas");d.style.cssText="position:absolute;top:0;left:0;width:100%;height:100%;display:block;",e.appendChild(d);const l=new V({canvas:d,antialias:!0,alpha:!0});l.setPixelRatio(Math.min(window.devicePixelRatio,2)),l.setSize(n,h);const a=new q,x=new H(42,n/h,.1,100);x.position.z=2.7;const r=new F;a.add(r),u.current={renderer:l,camera:x,group:r};const S=[];for(let t=0;t<3e3;t++)S.push((Math.random()-.5)*80,(Math.random()-.5)*80,(Math.random()-.5)*80);const z=new W;z.setAttribute("position",new U(new Float32Array(S),3)),a.add(new Z(z,new _({color:16777215,size:.06,transparent:!0,opacity:.55}))),a.add(new j(new P(1.22,64,64),new R({color:17510,transparent:!0,opacity:.09,side:J}))),a.add(new K(16777215,.9));const k=new I(16776672,1.1);k.position.set(5,3,5),a.add(k);const C=new I(2250154,.2);C.position.set(-5,-2,-3),a.add(C),new Q().load("/textures/earth.jpg",t=>r.add(new j(new P(1,64,64),new R({map:t,specular:new $(1118481),shininess:5}))),void 0,()=>r.add(new j(new P(1,64,64),new R({color:1789722})))),fetch("/textures/countries-110m.json").then(t=>t.json()).then(t=>{const s=N(t,t.objects.countries),o=new F;r.add(o),s.features.forEach(c=>{se(c,"#00ffff",.5).forEach(m=>o.add(m))})});const T=t=>{const s=e.getBoundingClientRect(),o="touches"in t?t.touches[0]:t;return{x:o.clientX-s.left,y:o.clientY-s.top}},X=t=>{const s=T(t);Object.assign(i.current,{drag:!0,px:s.x,py:s.y,vx:0,vy:0})},G=t=>{if(!i.current.drag)return;const s=T(t),o=i.current,c=s.x-o.px,m=s.y-o.py;o.vx=c*.007,o.vy=m*.005,o.rotY+=c*.007,o.rotX=Math.max(-1.3,Math.min(1.3,o.rotX+m*.005)),o.px=s.x,o.py=s.y},Y=()=>{i.current.drag=!1};e.addEventListener("mousedown",X),window.addEventListener("mousemove",G),window.addEventListener("mouseup",Y),e.addEventListener("touchstart",X,{passive:!0}),e.addEventListener("touchmove",G,{passive:!1}),e.addEventListener("touchend",Y),e.style.cursor="grab",e.addEventListener("mousedown",()=>e.style.cursor="grabbing"),e.addEventListener("mouseup",()=>e.style.cursor="grab");const A=()=>{f.current=requestAnimationFrame(A);const t=i.current;t.drag||(Math.abs(t.vx)>2e-4||Math.abs(t.vy)>2e-4?(t.rotY+=t.vx,t.rotX=Math.max(-1.3,Math.min(1.3,t.rotX+t.vy)),t.vx*=.93,t.vy*=.93):t.rotY+=8e-4),r.rotation.y=t.rotY,r.rotation.x=t.rotX,l.render(a,x);const s=e.offsetWidth||n,o=e.offsetHeight||h;g(O.map(c=>{const m=D(c.labelLat,c.labelLon,1);m.applyEuler(new ee(r.rotation.x,r.rotation.y,0,"YXZ"));const B=m.clone().project(x);return{id:c.id,name:c.name,emoji:c.emoji,color:c.color,x:(B.x+1)/2*s,y:(-B.y+1)/2*o,visible:m.z>.15}}))};A()}return b.jsxs("div",{ref:w,style:{position:"absolute",inset:0,background:"#00040e",overflow:"hidden"},children:[v.map(e=>e.visible&&b.jsx("button",{onClick:n=>{n.stopPropagation(),p(e.id)},onMouseDown:n=>n.stopPropagation(),style:{position:"absolute",left:e.x,top:e.y,transform:"translate(-50%,-50%)",zIndex:10,border:"none",background:"none",padding:0,cursor:"pointer"},children:b.jsxs("div",{style:{padding:"5px 13px",borderRadius:999,fontWeight:900,fontSize:13,whiteSpace:"nowrap",background:`${e.color}22`,border:`1.5px solid ${e.color}aa`,color:e.color,textShadow:`0 0 14px ${e.color},0 2px 4px rgba(0,0,0,0.9)`,boxShadow:`0 0 20px ${e.color}44,0 4px 12px rgba(0,0,0,0.6)`,backdropFilter:"blur(4px)",transition:"transform .15s"},onMouseEnter:n=>n.currentTarget.style.transform="scale(1.12)",onMouseLeave:n=>n.currentTarget.style.transform="scale(1)",children:[e.emoji," ",e.name]})},e.id)),b.jsx("div",{style:{position:"absolute",bottom:12,left:16,fontSize:11,color:"rgba(255,255,255,0.28)",pointerEvents:"none",userSelect:"none"},children:"ðŸ–± Drag to spin Â· Click a continent to play"})]})}export{ce as default};
