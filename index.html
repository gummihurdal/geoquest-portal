<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GeoQuest ‚Äî Explore the world one quiz at a time</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;0,900;1,400;1,700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<style>
:root {
  --night: #030b1a;
  --deep: #061226;
  --card: rgba(255,255,255,0.04);
  --border: rgba(255,255,255,0.07);
  --teal: #00d4c8;
  --gold: #ffd166;
  --coral: #ff6b6b;
  --mint: #06ffa5;
  --purple: #a78bfa;
  --text: #eaf4ff;
  --muted: #6b8da8;
}
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'Inter',sans-serif; background:var(--night); color:var(--text); overflow-x:hidden; min-height:100vh; }

#globe-canvas { position:fixed; top:0; left:0; width:100%; height:100%; z-index:0; pointer-events:none; }

nav {
  position:fixed; top:0; left:0; right:0; z-index:100;
  display:flex; align-items:center; justify-content:space-between;
  padding:0 48px; height:68px;
  background:rgba(3,11,26,0.85); backdrop-filter:blur(24px);
  border-bottom:1px solid var(--border);
}
.logo {
  font-family:'Playfair Display',serif; font-size:1.45rem; font-weight:900;
  background:linear-gradient(135deg,var(--teal),var(--gold));
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
}
.nav-center { display:flex; gap:4px; }
.nav-btn { background:none; border:none; color:var(--muted); font-family:'Inter',sans-serif; font-size:0.875rem; font-weight:500; padding:8px 18px; border-radius:50px; cursor:pointer; transition:all 0.2s; }
.nav-btn:hover,.nav-btn.active { color:var(--text); background:var(--card); }
.nav-right { display:flex; align-items:center; gap:12px; }
.streak-pill { display:flex; align-items:center; gap:6px; background:rgba(255,209,102,0.1); border:1px solid rgba(255,209,102,0.25); padding:6px 14px; border-radius:50px; font-size:0.8rem; color:var(--gold); font-weight:600; }
.btn-nav { background:linear-gradient(135deg,var(--teal),#0099cc); border:none; color:var(--night); padding:9px 22px; border-radius:50px; font-family:'Inter',sans-serif; font-size:0.875rem; font-weight:600; cursor:pointer; transition:all 0.2s; }
.btn-nav:hover { transform:translateY(-1px); box-shadow:0 6px 24px rgba(0,212,200,0.35); }

.screen { display:none; position:relative; z-index:1; }
.screen.active { display:block; }

#screen-home { padding-top:68px; }
.hero-section { min-height:calc(100vh - 68px); display:flex; flex-direction:column; align-items:center; justify-content:center; padding:60px 24px; text-align:center; }

.hero-badge { display:inline-flex; align-items:center; gap:8px; background:rgba(0,212,200,0.08); border:1px solid rgba(0,212,200,0.2); padding:8px 18px; border-radius:50px; font-size:0.78rem; font-weight:600; letter-spacing:2px; text-transform:uppercase; color:var(--teal); margin-bottom:32px; animation:fadeUp 0.8s ease both; }
.hero-title { font-family:'Playfair Display',serif; font-size:clamp(3rem,7vw,6.5rem); font-weight:900; line-height:1.0; margin-bottom:24px; animation:fadeUp 0.8s 0.1s ease both; }
.hero-title .grad { font-style:italic; background:linear-gradient(135deg,var(--teal) 0%,var(--gold) 100%); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
.hero-sub { font-size:1.1rem; color:var(--muted); max-width:480px; line-height:1.7; margin-bottom:48px; font-weight:300; animation:fadeUp 0.8s 0.2s ease both; }
.hero-sub strong { color:var(--gold); font-weight:600; }
.hero-actions { display:flex; gap:14px; flex-wrap:wrap; justify-content:center; animation:fadeUp 0.8s 0.3s ease both; }

@keyframes fadeUp { from{opacity:0;transform:translateY(24px)} to{opacity:1;transform:translateY(0)} }

.btn-primary { background:linear-gradient(135deg,var(--teal),#0099ee); border:none; color:var(--night); padding:16px 38px; border-radius:50px; font-family:'Inter',sans-serif; font-size:1rem; font-weight:700; cursor:pointer; transition:all 0.25s; box-shadow:0 4px 24px rgba(0,212,200,0.3); }
.btn-primary:hover { transform:translateY(-3px); box-shadow:0 12px 40px rgba(0,212,200,0.45); }
.btn-ghost { background:transparent; border:1px solid var(--border); color:var(--text); padding:16px 38px; border-radius:50px; font-family:'Inter',sans-serif; font-size:1rem; font-weight:500; cursor:pointer; transition:all 0.25s; }
.btn-ghost:hover { border-color:var(--teal); color:var(--teal); transform:translateY(-2px); }

.stats-row { display:flex; gap:1px; background:var(--border); border-top:1px solid var(--border); border-bottom:1px solid var(--border); }
.stat-cell { flex:1; padding:32px 20px; text-align:center; background:var(--deep); }
.stat-val { font-family:'Playfair Display',serif; font-size:2.2rem; font-weight:900; background:linear-gradient(135deg,var(--teal),var(--gold)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; display:block; }
.stat-lbl { font-size:0.72rem; color:var(--muted); text-transform:uppercase; letter-spacing:2px; margin-top:6px; }

.section { padding:80px 48px; max-width:1200px; margin:0 auto; }
.sec-eye { font-size:0.72rem; font-weight:700; letter-spacing:3px; text-transform:uppercase; color:var(--teal); margin-bottom:12px; }
.sec-title { font-family:'Playfair Display',serif; font-size:2.8rem; font-weight:900; margin-bottom:12px; line-height:1.1; }
.sec-sub { color:var(--muted); font-size:0.95rem; margin-bottom:48px; line-height:1.6; }

.daily-card { background:linear-gradient(135deg,rgba(0,212,200,0.08),rgba(167,139,250,0.08)); border:1px solid rgba(0,212,200,0.2); border-radius:24px; padding:28px 32px; margin-bottom:48px; display:flex; align-items:center; gap:24px; }
.daily-icon { font-size:3rem; }
.daily-content h3 { font-family:'Playfair Display',serif; font-size:1.3rem; font-weight:700; margin-bottom:4px; }
.daily-content p { font-size:0.875rem; color:var(--muted); }
.daily-cta { margin-left:auto; }

.continents-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:16px; }
.cont-card { position:relative; overflow:hidden; border-radius:24px; border:1px solid var(--border); background:var(--card); padding:32px 28px; cursor:pointer; transition:all 0.35s cubic-bezier(0.23,1,0.32,1); }
.cont-card::before { content:''; position:absolute; inset:0; background:linear-gradient(135deg,var(--cc,var(--teal)) 0%,transparent 70%); opacity:0; transition:opacity 0.35s; }
.cont-card:hover { transform:translateY(-6px) scale(1.01); border-color:var(--cc,var(--teal)); box-shadow:0 20px 60px rgba(0,0,0,0.4); }
.cont-card:hover::before { opacity:0.07; }
.cont-emoji { font-size:3.5rem; margin-bottom:20px; display:block; transition:transform 0.35s; position:relative; }
.cont-card:hover .cont-emoji { transform:scale(1.15) rotate(-5deg); }
.cont-name { font-family:'Playfair Display',serif; font-size:1.5rem; font-weight:700; margin-bottom:6px; position:relative; }
.cont-stats { font-size:0.82rem; color:var(--muted); margin-bottom:16px; position:relative; }
.cont-tag { display:inline-flex; align-items:center; gap:6px; background:rgba(255,255,255,0.06); border:1px solid var(--border); padding:4px 12px; border-radius:50px; font-size:0.75rem; color:var(--cc,var(--teal)); font-weight:600; position:relative; }

.cats-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(200px,1fr)); gap:12px; }
.cat-card { background:var(--card); border:1px solid var(--border); border-radius:20px; padding:28px 20px; text-align:center; cursor:pointer; transition:all 0.3s cubic-bezier(0.23,1,0.32,1); position:relative; overflow:hidden; }
.cat-card::after { content:''; position:absolute; bottom:0; left:0; right:0; height:3px; background:linear-gradient(90deg,var(--cc2,var(--teal)),transparent); transform:scaleX(0); transition:transform 0.3s; transform-origin:left; }
.cat-card:hover { transform:translateY(-4px); border-color:var(--cc2,var(--teal)); }
.cat-card:hover::after { transform:scaleX(1); }
.cat-icon-w { width:56px; height:56px; border-radius:16px; background:rgba(255,255,255,0.05); display:flex; align-items:center; justify-content:center; font-size:1.8rem; margin:0 auto 16px; transition:all 0.3s; }
.cat-card:hover .cat-icon-w { background:rgba(255,255,255,0.08); transform:scale(1.1); }
.cat-name { font-family:'Playfair Display',serif; font-size:1rem; font-weight:700; margin-bottom:6px; }
.cat-count { font-size:0.75rem; color:var(--muted); }

#screen-continent { padding:68px 0 0; min-height:100vh; }
.cq-wrap { max-width:800px; margin:0 auto; padding:48px 24px; }
.cq-header { text-align:center; margin-bottom:40px; }
.cq-big-emoji { font-size:5rem; margin-bottom:16px; display:block; }
.cq-header h2 { font-family:'Playfair Display',serif; font-size:3rem; font-weight:900; margin-bottom:8px; }
.cq-header p { color:var(--muted); }
.cq-timer-big { font-family:'Playfair Display',serif; font-size:4rem; font-weight:900; background:linear-gradient(135deg,var(--teal),var(--gold)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; line-height:1; text-align:center; margin-bottom:4px; }
.cq-timer-big.urgent { background:linear-gradient(135deg,var(--coral),#ff9f43); -webkit-background-clip:text; -webkit-text-fill-color:transparent; animation:pulse 0.5s ease infinite alternate; }
.cq-timer-lbl { font-size:0.72rem; color:var(--muted); text-transform:uppercase; letter-spacing:2px; text-align:center; margin-bottom:32px; }
@keyframes pulse { from{opacity:1} to{opacity:0.4} }

.cq-box { background:var(--card); border:1px solid var(--border); border-radius:24px; padding:32px; margin-bottom:24px; }
.cq-prog-info { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
.cq-prog-info span { font-size:0.85rem; color:var(--muted); }
.cq-prog-info strong { color:var(--teal); font-size:1.1rem; }
.cq-bar { height:6px; background:var(--border); border-radius:6px; overflow:hidden; margin-bottom:20px; }
.cq-bar-fill { height:100%; border-radius:6px; background:linear-gradient(90deg,var(--teal),var(--gold)); transition:width 0.5s cubic-bezier(0.23,1,0.32,1); }
.cq-input-row { display:flex; gap:12px; }
.cq-input { flex:1; background:rgba(255,255,255,0.05); border:1px solid var(--border); border-radius:14px; padding:14px 20px; color:var(--text); font-family:'Inter',sans-serif; font-size:1rem; outline:none; transition:border-color 0.2s; }
.cq-input:focus { border-color:var(--teal); }
.cq-input::placeholder { color:var(--muted); }
.btn-enter { background:linear-gradient(135deg,var(--teal),#0099ee); border:none; color:var(--night); padding:14px 28px; border-radius:14px; font-weight:700; cursor:pointer; font-family:'Inter',sans-serif; font-size:0.95rem; transition:all 0.2s; white-space:nowrap; }
.btn-enter:hover { transform:translateY(-1px); box-shadow:0 6px 20px rgba(0,212,200,0.35); }
.found-tags { display:flex; flex-wrap:wrap; gap:8px; margin-top:24px; min-height:40px; }
.found-tag { background:rgba(0,212,200,0.1); border:1px solid rgba(0,212,200,0.25); color:var(--teal); padding:6px 14px; border-radius:50px; font-size:0.82rem; font-weight:500; animation:popIn 0.3s cubic-bezier(0.23,1,0.32,1); }
@keyframes popIn { from{transform:scale(0.5);opacity:0} to{transform:scale(1);opacity:1} }

.cq-actions { display:flex; gap:12px; justify-content:center; flex-wrap:wrap; margin-top:20px; }
.btn-hint { background:rgba(255,209,102,0.1); border:1px solid rgba(255,209,102,0.25); color:var(--gold); padding:12px 24px; border-radius:50px; font-weight:600; cursor:pointer; font-family:'Inter',sans-serif; font-size:0.875rem; transition:all 0.2s; }
.btn-hint:hover { background:rgba(255,209,102,0.15); }
.btn-giveup { background:rgba(255,107,107,0.08); border:1px solid rgba(255,107,107,0.2); color:var(--coral); padding:12px 24px; border-radius:50px; font-weight:600; cursor:pointer; font-family:'Inter',sans-serif; font-size:0.875rem; transition:all 0.2s; }

.missed-box { background:var(--card); border:1px solid var(--border); border-radius:20px; padding:24px; margin-top:16px; display:none; }
.missed-title { font-size:0.8rem; color:var(--muted); text-transform:uppercase; letter-spacing:2px; margin-bottom:12px; }
.missed-tags { display:flex; flex-wrap:wrap; gap:8px; }
.missed-tag { background:rgba(255,255,255,0.04); border:1px solid var(--border); color:var(--muted); padding:5px 12px; border-radius:50px; font-size:0.78rem; }

#screen-quiz { padding:68px 0 0; min-height:100vh; display:flex; align-items:center; justify-content:center; }
.q-wrap { max-width:680px; width:100%; padding:40px 24px; }
.q-top { display:flex; align-items:center; gap:16px; margin-bottom:32px; }
.q-prog-w { flex:1; }
.q-bar { height:5px; background:var(--border); border-radius:5px; overflow:hidden; }
.q-bar-fill { height:100%; border-radius:5px; background:linear-gradient(90deg,var(--teal),var(--gold)); transition:width 0.5s ease; }
.q-num { font-size:0.8rem; color:var(--muted); margin-top:6px; text-align:center; }
.q-timer { font-family:'Playfair Display',serif; font-size:1.6rem; font-weight:900; color:var(--gold); min-width:44px; text-align:right; }
.q-timer.urgent { color:var(--coral); animation:pulse 0.5s ease infinite alternate; }
.q-cat { display:inline-flex; align-items:center; gap:8px; font-size:0.75rem; font-weight:600; letter-spacing:1.5px; text-transform:uppercase; color:var(--teal); margin-bottom:16px; }
.q-box { background:var(--card); border:1px solid var(--border); border-radius:28px; padding:40px; margin-bottom:20px; position:relative; overflow:hidden; }
.q-box::before { content:''; position:absolute; top:0; left:0; right:0; height:1px; background:linear-gradient(90deg,transparent,var(--teal),transparent); }
.q-text { font-family:'Playfair Display',serif; font-size:clamp(1.2rem,3vw,1.75rem); font-weight:700; line-height:1.3; }
.opts-grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
.opt-btn { background:var(--card); border:1px solid var(--border); border-radius:18px; padding:18px 20px; color:var(--text); font-family:'Inter',sans-serif; font-size:0.92rem; cursor:pointer; transition:all 0.2s; text-align:left; display:flex; align-items:center; gap:12px; }
.opt-btn:hover:not(:disabled) { border-color:var(--teal); transform:translateY(-2px); background:rgba(0,212,200,0.05); }
.opt-letter { width:30px; height:30px; border-radius:10px; background:rgba(255,255,255,0.07); display:flex; align-items:center; justify-content:center; font-size:0.72rem; font-weight:700; flex-shrink:0; color:var(--muted); }
.opt-btn.correct { border-color:var(--mint); background:rgba(6,255,165,0.07); }
.opt-btn.correct .opt-letter { background:var(--mint); color:var(--night); }
.opt-btn.wrong { border-color:var(--coral); background:rgba(255,107,107,0.07); }
.opt-btn.wrong .opt-letter { background:var(--coral); color:white; }
.opt-btn:disabled { cursor:not-allowed; }
.fact-box { background:rgba(255,209,102,0.06); border:1px solid rgba(255,209,102,0.18); border-radius:18px; padding:16px 20px; margin-top:14px; display:none; animation:fadeUp 0.4s ease; gap:10px; align-items:flex-start; }
.fact-box.show { display:flex; }
.fact-icon { font-size:1.1rem; flex-shrink:0; }
.fact-text { font-size:0.875rem; color:var(--gold); line-height:1.5; }

#screen-results { padding:68px 0 0; min-height:100vh; display:flex; align-items:center; justify-content:center; }
.res-wrap { max-width:560px; width:100%; padding:40px 24px; text-align:center; }
.score-ring { width:200px; height:200px; margin:0 auto 40px; position:relative; }
.score-ring svg { transform:rotate(-90deg); }
.score-center { position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; }
.score-big { font-family:'Playfair Display',serif; font-size:3rem; font-weight:900; background:linear-gradient(135deg,var(--teal),var(--gold)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; line-height:1; }
.score-lbl { font-size:0.7rem; color:var(--muted); text-transform:uppercase; letter-spacing:2px; margin-top:4px; }
.res-title { font-family:'Playfair Display',serif; font-size:2.2rem; font-weight:900; margin-bottom:8px; }
.res-sub { color:var(--muted); margin-bottom:36px; font-size:0.95rem; }
.res-cards { display:flex; gap:12px; justify-content:center; margin-bottom:36px; flex-wrap:wrap; }
.res-card { background:var(--card); border:1px solid var(--border); border-radius:18px; padding:20px 28px; flex:1; min-width:110px; }
.res-card-val { font-family:'Playfair Display',serif; font-size:1.8rem; font-weight:900; color:var(--gold); display:block; }
.res-card-lbl { font-size:0.72rem; color:var(--muted); margin-top:4px; }
.res-actions { display:flex; gap:12px; justify-content:center; flex-wrap:wrap; }

#screen-leaderboard { padding:68px 0 0; min-height:100vh; }
.lb-wrap { max-width:760px; margin:0 auto; padding:48px 24px; }
.lb-list { display:flex; flex-direction:column; gap:8px; }
.lb-item { background:var(--card); border:1px solid var(--border); border-radius:18px; padding:18px 24px; display:flex; align-items:center; gap:16px; transition:all 0.2s; }
.lb-item:hover { border-color:rgba(0,212,200,0.2); transform:translateX(4px); }
.lb-item.me { background:rgba(0,212,200,0.06); border-color:rgba(0,212,200,0.25); }
.lb-rank { font-family:'Playfair Display',serif; font-size:1.3rem; font-weight:900; width:36px; text-align:center; color:var(--muted); }
.lb-rank.r1{color:var(--gold)} .lb-rank.r2{color:#c0c0c0} .lb-rank.r3{color:#cd7f32}
.lb-avatar { width:42px; height:42px; border-radius:14px; background:linear-gradient(135deg,var(--teal),var(--purple)); display:flex; align-items:center; justify-content:center; font-size:1.1rem; flex-shrink:0; }
.lb-info { flex:1; }
.lb-name { font-weight:600; font-size:0.95rem; }
.lb-country { font-size:0.78rem; color:var(--muted); margin-top:2px; }
.lb-pts { font-family:'Playfair Display',serif; font-size:1.2rem; font-weight:900; color:var(--teal); }
.lb-games { font-size:0.72rem; color:var(--muted); margin-top:2px; }

.modal-overlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.75); backdrop-filter:blur(12px); z-index:200; align-items:center; justify-content:center; }
.modal-overlay.show { display:flex; }
.modal { background:linear-gradient(160deg,#0a1a30,var(--deep)); border:1px solid var(--border); border-radius:32px; padding:44px; max-width:420px; width:90%; animation:modalIn 0.35s cubic-bezier(0.23,1,0.32,1); position:relative; overflow:hidden; }
.modal::before { content:''; position:absolute; top:0; left:0; right:0; height:1px; background:linear-gradient(90deg,transparent,var(--teal),transparent); }
@keyframes modalIn { from{opacity:0;transform:scale(0.9) translateY(20px)} to{opacity:1;transform:scale(1) translateY(0)} }
.modal h2 { font-family:'Playfair Display',serif; font-size:2rem; font-weight:900; margin-bottom:6px; }
.modal p { color:var(--muted); margin-bottom:28px; font-size:0.9rem; line-height:1.5; }
.form-field { margin-bottom:16px; }
.form-field label { display:block; font-size:0.72rem; font-weight:600; letter-spacing:1.5px; text-transform:uppercase; color:var(--muted); margin-bottom:8px; }
.form-field input,.form-field select { width:100%; background:rgba(255,255,255,0.04); border:1px solid var(--border); border-radius:14px; padding:13px 18px; color:var(--text); font-family:'Inter',sans-serif; font-size:0.95rem; outline:none; transition:border-color 0.2s; }
.form-field input:focus,.form-field select:focus { border-color:var(--teal); }
.form-field select option { background:var(--deep); }
.modal-btns { display:flex; flex-direction:column; gap:10px; margin-top:24px; }
.btn-modal-p { background:linear-gradient(135deg,var(--teal),#0099ee); border:none; color:var(--night); padding:15px; border-radius:14px; font-weight:700; cursor:pointer; font-family:'Inter',sans-serif; font-size:1rem; transition:all 0.2s; }
.btn-modal-p:hover { transform:translateY(-1px); box-shadow:0 6px 20px rgba(0,212,200,0.3); }
.btn-modal-g { background:transparent; border:1px solid var(--border); color:var(--muted); padding:14px; border-radius:14px; font-weight:500; cursor:pointer; font-family:'Inter',sans-serif; font-size:0.95rem; transition:all 0.2s; }
.btn-modal-g:hover { color:var(--text); }

.toast { position:fixed; bottom:32px; left:50%; transform:translateX(-50%) translateY(80px); background:rgba(6,18,38,0.95); backdrop-filter:blur(16px); border:1px solid var(--border); border-radius:50px; padding:12px 24px; font-size:0.875rem; font-weight:500; z-index:400; transition:transform 0.35s cubic-bezier(0.23,1,0.32,1); white-space:nowrap; }
.toast.show { transform:translateX(-50%) translateY(0); }
.toast.success { border-color:rgba(6,255,165,0.3); color:var(--mint); }
.toast.error { border-color:rgba(255,107,107,0.3); color:var(--coral); }
.toast.info { border-color:rgba(0,212,200,0.3); color:var(--teal); }

.particle { position:fixed; pointer-events:none; z-index:500; border-radius:50%; animation:pfly 0.9s ease forwards; }
@keyframes pfly { 0%{transform:translate(0,0) scale(1);opacity:1} 100%{transform:translate(var(--tx),var(--ty)) scale(0);opacity:0} }

.spin { width:24px; height:24px; border-radius:50%; border:2px solid var(--border); border-top-color:var(--teal); animation:spinA 0.7s linear infinite; display:inline-block; }
@keyframes spinA { to{transform:rotate(360deg)} }
.empty-state { text-align:center; padding:60px 20px; color:var(--muted); }
.empty-state .ei { font-size:3.5rem; margin-bottom:16px; }

@media(max-width:768px){
  nav { padding:0 20px; }
  .section { padding:48px 20px; }
  .opts-grid { grid-template-columns:1fr; }
  .q-box { padding:28px 20px; }
  .continents-grid { grid-template-columns:1fr 1fr; }
  .hero-title { font-size:2.8rem; }
  .cats-grid { grid-template-columns:repeat(2,1fr); }
  .daily-card { flex-direction:column; text-align:center; }
  .daily-cta { margin-left:0; }
  .stat-lbl { font-size:0.6rem; letter-spacing:1px; }
}
</style>
</head>
<body>
<canvas id="globe-canvas"></canvas>

<nav>
  <div class="logo">GeoQuest</div>
  <div class="nav-center">
    <button class="nav-btn active" id="nav-home" onclick="showScreen('home')">Explore</button>
    <button class="nav-btn" id="nav-continents" onclick="showScreen('continents')">üåç Continents</button>
    <button class="nav-btn" id="nav-leaderboard" onclick="showScreen('leaderboard')">üèÜ Ranks</button>
  </div>
  <div class="nav-right">
    <div class="streak-pill" id="streak-pill" style="display:none">üî• <span id="streak-num">0</span></div>
    <button class="btn-nav" id="auth-btn" onclick="showLogin()">Sign in</button>
  </div>
</nav>

<!-- HOME -->
<div class="screen active" id="screen-home">
  <div class="hero-section">
    <div class="hero-badge">üåç Geography ¬∑ Science ¬∑ Space ¬∑ Trivia</div>
    <h1 class="hero-title">Explore the world<br><span class="grad">one quiz at a time</span></h1>
    <p class="hero-sub">Welcome, <strong>Sarah Thordarson üáÆüá∏</strong><br>Challenge your knowledge of every corner of our planet</p>
    <div class="hero-actions">
      <button class="btn-primary" onclick="startDailyChallenge()">‚ö° Daily Challenge</button>
      <button class="btn-ghost" onclick="showScreen('continents')">üåç Continent Explorer</button>
    </div>
  </div>

  <div class="stats-row">
    <div class="stat-cell"><span class="stat-val" id="stat-played">0</span><div class="stat-lbl">Quizzes</div></div>
    <div class="stat-cell"><span class="stat-val" id="stat-score">0</span><div class="stat-lbl">Points</div></div>
    <div class="stat-cell"><span class="stat-val" id="stat-streak">0</span><div class="stat-lbl">Streak üî•</div></div>
    <div class="stat-cell"><span class="stat-val" id="stat-rank">#‚Äî</span><div class="stat-lbl">Global Rank</div></div>
  </div>

  <div class="section">
    <div class="daily-card">
      <div class="daily-icon">‚ö°</div>
      <div class="daily-content">
        <h3 id="daily-theme">Today's Daily Challenge</h3>
        <p>A fresh mixed quiz every day ‚Äî geography, space, flags & world records</p>
      </div>
      <div class="daily-cta"><button class="btn-primary" onclick="startDailyChallenge()">Start Now ‚Üí</button></div>
    </div>
    <div class="sec-eye">Quiz Topics</div>
    <h2 class="sec-title">Choose your challenge</h2>
    <p class="sec-sub">10 questions ¬∑ 20 seconds each ¬∑ Global leaderboard</p>
    <div class="cats-grid" id="cats-grid"></div>
  </div>
</div>

<!-- CONTINENTS -->
<div class="screen" id="screen-continents">
  <div class="section">
    <div class="sec-eye">Continent Explorer</div>
    <h2 class="sec-title">Name every country</h2>
    <p class="sec-sub">Select a continent and name as many countries as you can before time runs out</p>
    <div class="continents-grid" id="conts-grid"></div>
  </div>
</div>

<!-- CONTINENT QUIZ -->
<div class="screen" id="screen-continent">
  <div class="cq-wrap">
    <div class="cq-header">
      <span class="cq-big-emoji" id="cq-emoji">üåç</span>
      <h2 id="cq-title">Africa</h2>
      <p id="cq-sub">Name all countries</p>
    </div>
    <div class="cq-timer-big" id="cq-timer">5:00</div>
    <div class="cq-timer-lbl">Time Remaining</div>
    <div class="cq-box">
      <div class="cq-prog-info">
        <span>Countries found</span>
        <strong id="cq-count">0 / 0</strong>
      </div>
      <div class="cq-bar"><div class="cq-bar-fill" id="cq-bar" style="width:0%"></div></div>
      <div class="cq-input-row">
        <input type="text" class="cq-input" id="cq-input" placeholder="Type a country name and press Enter..." autocomplete="off" onkeydown="if(event.key==='Enter')submitCountry()">
        <button class="btn-enter" onclick="submitCountry()">Enter</button>
      </div>
      <div class="found-tags" id="found-tags"></div>
    </div>
    <div class="cq-actions">
      <button class="btn-hint" onclick="giveHint()">üí° Hint (‚àí50pts)</button>
      <button class="btn-giveup" onclick="giveUp()">üè≥Ô∏è Give Up</button>
      <button class="btn-ghost" onclick="showScreen('continents')" style="padding:12px 24px;font-size:0.875rem">‚Üê Back</button>
    </div>
    <div class="missed-box" id="missed-box">
      <div class="missed-title">Countries you missed</div>
      <div class="missed-tags" id="missed-tags"></div>
    </div>
  </div>
</div>

<!-- QUIZ -->
<div class="screen" id="screen-quiz">
  <div class="q-wrap">
    <div class="q-top">
      <button onclick="exitQuiz()" style="background:none;border:1px solid var(--border);color:var(--muted);padding:8px 16px;border-radius:50px;cursor:pointer;font-family:inherit;font-size:0.8rem;white-space:nowrap">‚úï Exit</button>
      <div class="q-prog-w">
        <div class="q-bar"><div class="q-bar-fill" id="q-prog" style="width:0%"></div></div>
        <div class="q-num" id="q-num">Question 1 of 10</div>
      </div>
      <div class="q-timer" id="q-timer">20</div>
    </div>
    <div class="q-cat" id="q-cat">üåç World Capitals</div>
    <div class="q-box"><div class="q-text" id="q-text">Loading...</div></div>
    <div class="fact-box" id="fact-box">
      <span class="fact-icon">üí°</span>
      <span class="fact-text" id="fact-text"></span>
    </div>
    <div class="opts-grid" id="opts-grid"></div>
    <div style="text-align:center;margin-top:20px">
      <button class="btn-primary" id="next-btn" style="display:none" onclick="nextQ()">Next ‚Üí</button>
    </div>
  </div>
</div>

<!-- RESULTS -->
<div class="screen" id="screen-results">
  <div class="res-wrap">
    <div class="score-ring">
      <svg viewBox="0 0 200 200" width="200" height="200">
        <circle cx="100" cy="100" r="84" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="12"/>
        <circle cx="100" cy="100" r="84" fill="none" stroke="url(#rg)" stroke-width="12" stroke-linecap="round" stroke-dasharray="528" stroke-dashoffset="528" id="score-arc"/>
        <defs><linearGradient id="rg" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#00d4c8"/><stop offset="100%" stop-color="#ffd166"/></linearGradient></defs>
      </svg>
      <div class="score-center">
        <div class="score-big" id="res-pts">0</div>
        <div class="score-lbl">points</div>
      </div>
    </div>
    <h2 class="res-title" id="res-title">Well done!</h2>
    <p class="res-sub" id="res-sub"></p>
    <div class="res-cards">
      <div class="res-card"><span class="res-card-val" id="res-correct">0</span><div class="res-card-lbl">Correct ‚úì</div></div>
      <div class="res-card"><span class="res-card-val" id="res-wrong">0</span><div class="res-card-lbl">Wrong ‚úó</div></div>
      <div class="res-card"><span class="res-card-val" id="res-avg">0s</span><div class="res-card-lbl">Avg Speed</div></div>
    </div>
    <div class="res-actions">
      <button class="btn-primary" onclick="playAgain()">Play Again</button>
      <button class="btn-ghost" onclick="showScreen('leaderboard')">üèÜ Leaderboard</button>
      <button class="btn-ghost" onclick="showScreen('home')">‚Üê Home</button>
    </div>
  </div>
</div>

<!-- LEADERBOARD -->
<div class="screen" id="screen-leaderboard">
  <div class="lb-wrap">
    <div class="sec-eye">Global Rankings</div>
    <h2 class="sec-title" style="margin-bottom:8px">Hall of Fame</h2>
    <p style="color:var(--muted);font-size:0.9rem;margin-bottom:32px">Top explorers from around the world</p>
    <div class="lb-list" id="lb-list"><div style="text-align:center;padding:40px"><div class="spin"></div></div></div>
  </div>
</div>

<!-- MODAL -->
<div class="modal-overlay" id="login-modal">
  <div class="modal">
    <h2>Join GeoQuest üåç</h2>
    <p>Create your explorer profile and compete on the global leaderboard</p>
    <div class="form-field"><label>Username</label><input type="text" id="inp-user" placeholder="e.g. geo_sarah"/></div>
    <div class="form-field"><label>Email (optional)</label><input type="email" id="inp-email" placeholder="sarah@example.com"/></div>
    <div class="form-field"><label>Your Country</label>
      <select id="inp-country">
        <option value="">Select...</option>
        <option value="IS">üáÆüá∏ Iceland</option>
        <option value="CH">üá®üá≠ Switzerland</option>
        <option value="US">üá∫üá∏ United States</option>
        <option value="GB">üá¨üáß United Kingdom</option>
        <option value="NO">üá≥üá¥ Norway</option>
        <option value="SE">üá∏üá™ Sweden</option>
        <option value="DK">üá©üá∞ Denmark</option>
        <option value="FI">üá´üáÆ Finland</option>
        <option value="DE">üá©üá™ Germany</option>
        <option value="FR">üá´üá∑ France</option>
        <option value="IT">üáÆüáπ Italy</option>
        <option value="AT">üá¶üáπ Austria</option>
        <option value="Other">üåç Other</option>
      </select>
    </div>
    <div class="modal-btns">
      <button class="btn-modal-p" onclick="createPlayer()">Create Profile üöÄ</button>
      <button class="btn-modal-g" onclick="closeModal()">Maybe later</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// ‚îÄ‚îÄ 3D GLOBE ‚îÄ‚îÄ
(function(){
  const canvas = document.getElementById('globe-canvas');
  const renderer = new THREE.WebGLRenderer({canvas,antialias:true,alpha:true});
  renderer.setPixelRatio(Math.min(devicePixelRatio,2));
  renderer.setSize(innerWidth,innerHeight);
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(45,innerWidth/innerHeight,0.1,1000);
  camera.position.z = 2.8;
  const globe = new THREE.Mesh(new THREE.SphereGeometry(1,64,64), new THREE.MeshPhongMaterial({color:0x0a1628,emissive:0x061020,specular:0x00d4c8,shininess:15,transparent:true,opacity:0.9}));
  scene.add(globe);
  const wire = new THREE.Mesh(new THREE.SphereGeometry(1.001,32,32), new THREE.MeshBasicMaterial({color:0x00d4c8,wireframe:true,transparent:true,opacity:0.05}));
  scene.add(wire);
  scene.add(new THREE.Mesh(new THREE.SphereGeometry(1.18,64,64), new THREE.MeshPhongMaterial({color:0x0066aa,transparent:true,opacity:0.07,side:THREE.BackSide})));
  const dpos=[]; for(let i=0;i<600;i++){const phi=Math.acos(-1+2*Math.random()),th=Math.random()*2*Math.PI,r=1.015;dpos.push(r*Math.sin(phi)*Math.cos(th),r*Math.sin(phi)*Math.sin(th),r*Math.cos(phi));}
  const dg=new THREE.BufferGeometry(); dg.setAttribute('position',new THREE.Float32BufferAttribute(dpos,3));
  scene.add(new THREE.Points(dg,new THREE.PointsMaterial({color:0x00d4c8,size:0.012,transparent:true,opacity:0.45})));
  const sp=[]; for(let i=0;i<2000;i++){sp.push((Math.random()-.5)*100,(Math.random()-.5)*100,(Math.random()-.5)*100);}
  const sg=new THREE.BufferGeometry(); sg.setAttribute('position',new THREE.Float32BufferAttribute(sp,3));
  scene.add(new THREE.Points(sg,new THREE.PointsMaterial({color:0xffffff,size:0.05,transparent:true,opacity:0.55})));
  const al=new THREE.AmbientLight(0x112244,1.5); scene.add(al);
  const dl=new THREE.DirectionalLight(0x00d4c8,1.2); dl.position.set(5,3,5); scene.add(dl);
  const dl2=new THREE.DirectionalLight(0xffd166,0.4); dl2.position.set(-5,-3,-2); scene.add(dl2);
  let t=0;
  (function animate(){requestAnimationFrame(animate);t+=0.003;globe.rotation.y+=0.0012;wire.rotation.y+=0.0012;globe.rotation.x=Math.sin(t*.3)*.05;renderer.render(scene,camera);})();
  window.addEventListener('resize',()=>{camera.aspect=innerWidth/innerHeight;camera.updateProjectionMatrix();renderer.setSize(innerWidth,innerHeight);});
})();

// ‚îÄ‚îÄ SUPABASE ‚îÄ‚îÄ
const SB='https://mjphpctvuxmbjhmcscoj.supabase.co';
const SK='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1qcGhwY3R2dXhtYmpobWNzY29qIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIyMjgzMzQsImV4cCI6MjA4NzgwNDMzNH0.dsmzK7SS4_RSC5wbN6ifhjRlOSbfDZjIcfh2MKkDQIs';
const H={apikey:SK,Authorization:`Bearer ${SK}`,'Content-Type':'application/json'};
const db={
  get:async(t,q='')=>(await fetch(`${SB}/rest/v1/${t}?${q}`,{headers:H})).json(),
  post:async(t,d)=>(await fetch(`${SB}/rest/v1/${t}`,{method:'POST',headers:{...H,Prefer:'return=representation'},body:JSON.stringify(d)})).json(),
  patch:async(t,id,d)=>(await fetch(`${SB}/rest/v1/${t}?id=eq.${id}`,{method:'PATCH',headers:{...H,Prefer:'return=representation'},body:JSON.stringify(d)})).json(),
};

// ‚îÄ‚îÄ QUESTIONS ‚îÄ‚îÄ
const Q={
  capitals:[
    {q:"Capital of Iceland?",a:"b",o:["Copenhagen","Reykjavik","Helsinki","Oslo"],f:"Reykjavik is the world's northernmost capital city!"},
    {q:"Capital of Australia?",a:"c",o:["Sydney","Melbourne","Canberra","Brisbane"],f:"Canberra was purpose-built as a compromise between Sydney & Melbourne!"},
    {q:"Capital of Brazil?",a:"a",o:["Bras√≠lia","Rio de Janeiro","S√£o Paulo","Salvador"],f:"Bras√≠lia was built in just 41 months, becoming capital in 1960!"},
    {q:"Capital of Canada?",a:"b",o:["Toronto","Ottawa","Montreal","Vancouver"],f:"Ottawa was chosen partly because it was harder to attack!"},
    {q:"Capital of South Africa?",a:"d",o:["Johannesburg","Durban","Cape Town","Pretoria"],f:"South Africa has THREE capitals ‚Äî executive, legislative and judicial!"},
    {q:"Capital of New Zealand?",a:"b",o:["Auckland","Wellington","Christchurch","Dunedin"],f:"Wellington is the southernmost national capital in the world!"},
    {q:"Capital of Kazakhstan?",a:"a",o:["Astana","Almaty","Shymkent","Karaganda"],f:"Astana was renamed Nur-Sultan 2019‚Äì2022, then back to Astana!"},
    {q:"Capital of Myanmar?",a:"c",o:["Yangon","Mandalay","Naypyidaw","Bago"],f:"Myanmar moved its capital overnight in 2006 without public announcement!"},
    {q:"Capital of Bolivia?",a:"b",o:["La Paz","Sucre","Santa Cruz","Cochabamba"],f:"Bolivia has TWO capitals ‚Äî Sucre is constitutional, La Paz is government!"},
    {q:"Capital of Mongolia?",a:"d",o:["Darkhan","Erdenet","Choibalsan","Ulaanbaatar"],f:"Ulaanbaatar means 'Red Hero' and is the coldest capital in the world!"},
    {q:"Capital of Bhutan?",a:"b",o:["Paro","Thimphu","Punakha","Wangdue"],f:"Thimphu has no traffic lights ‚Äî police direct traffic by hand!"},
    {q:"Capital of Kenya?",a:"a",o:["Nairobi","Mombasa","Kisumu","Nakuru"],f:"Nairobi has a national park within city limits ‚Äî the only capital to do so!"},
    {q:"Capital of Peru?",a:"c",o:["Cusco","Arequipa","Lima","Trujillo"],f:"Lima is home to over 10 million people ‚Äî a third of Peru's population!"},
    {q:"Capital of Thailand?",a:"b",o:["Chiang Mai","Bangkok","Phuket","Pattaya"],f:"Bangkok's official Thai name is 169 characters ‚Äî world's longest city name!"},
    {q:"Capital of Nigeria?",a:"d",o:["Lagos","Kano","Ibadan","Abuja"],f:"Nigeria moved its capital from Lagos to Abuja in 1991!"},
    {q:"Capital of Argentina?",a:"a",o:["Buenos Aires","C√≥rdoba","Rosario","Mendoza"],f:"Buenos Aires means 'Fair Winds' in Spanish!"},
    {q:"Capital of Egypt?",a:"b",o:["Alexandria","Cairo","Luxor","Giza"],f:"Cairo is the largest city in Africa and the Arab world!"},
    {q:"Capital of Japan?",a:"c",o:["Osaka","Kyoto","Tokyo","Hiroshima"],f:"Tokyo is the world's most populous metropolitan area with 37 million people!"},
    {q:"Capital of Indonesia?",a:"d",o:["Bali","Surabaya","Bandung","Jakarta"],f:"Indonesia is building a new capital called Nusantara to replace Jakarta!"},
    {q:"Capital of Pakistan?",a:"b",o:["Lahore","Islamabad","Karachi","Peshawar"],f:"Islamabad replaced Karachi as the capital in 1966 ‚Äî purpose-built like Bras√≠lia!"},
  ],
  geography:[
    {q:"Which country has the most time zones?",a:"a",o:["France","Russia","USA","China"],f:"France has 12 time zones due to its overseas territories!"},
    {q:"World's largest country by area?",a:"c",o:["Canada","China","Russia","USA"],f:"Russia covers ~11% of Earth's entire land mass across 11 time zones!"},
    {q:"World's smallest country?",a:"b",o:["Monaco","Vatican City","San Marino","Liechtenstein"],f:"Vatican City covers just 0.44 km¬≤ ‚Äî smaller than most city parks!"},
    {q:"What % of Earth's surface is water?",a:"a",o:["71%","61%","81%","51%"],f:"Despite being called 'Earth', 71% of our planet is covered by oceans!"},
    {q:"Which country has the most natural lakes?",a:"d",o:["Russia","USA","Finland","Canada"],f:"Canada has ~879,800 lakes ‚Äî more than all other countries combined!"},
    {q:"World's longest river?",a:"b",o:["Amazon","Nile","Yangtze","Mississippi"],f:"The Nile vs Amazon debate continues ‚Äî some say Amazon might be longer!"},
    {q:"Which country has the longest coastline?",a:"a",o:["Canada","Norway","Russia","Indonesia"],f:"Canada's coastline is 202,080 km ‚Äî enough to circle Earth 5 times!"},
    {q:"World's deepest lake?",a:"c",o:["Lake Superior","Tanganyika","Lake Baikal","Crater Lake"],f:"Lake Baikal is 1,642m deep and holds ~20% of all unfrozen fresh water!"},
    {q:"Which continent has the most countries?",a:"b",o:["Asia","Africa","Europe","Americas"],f:"Africa has 54 recognized countries ‚Äî more than any other continent!"},
    {q:"World's largest desert?",a:"b",o:["Sahara","Antarctica","Arabian","Gobi"],f:"Antarctica IS a desert! Deserts are defined by low precipitation, not heat!"},
    {q:"Highest mountain range in the world?",a:"a",o:["Himalayas","Andes","Alps","Rockies"],f:"The Himalayas contain all 14 mountains over 8,000 metres on Earth!"},
    {q:"Which country has the highest average elevation?",a:"c",o:["Nepal","Peru","Bhutan","Afghanistan"],f:"Bhutan averages 3,280m elevation ‚Äî even its lowest valley is over 1,000m!"},
    {q:"World's largest ocean?",a:"a",o:["Pacific","Atlantic","Indian","Arctic"],f:"The Pacific covers more area than ALL of Earth's landmasses combined!"},
    {q:"Which river flows through the most countries?",a:"d",o:["Amazon","Nile","Mississippi","Danube"],f:"The Danube flows through 10 countries ‚Äî more than any other river in the world!"},
  ],
  solar:[
    {q:"How many planets in our solar system?",a:"c",o:["7","9","8","10"],f:"Pluto was reclassified as a dwarf planet in 2006, leaving 8 official planets!"},
    {q:"Which planet has the most moons?",a:"a",o:["Saturn","Jupiter","Uranus","Neptune"],f:"Saturn has 146 confirmed moons as of 2023!"},
    {q:"Light travel time from Sun to Earth?",a:"b",o:["1 minute","8 minutes","30 minutes","1 hour"],f:"Light travels at 299,792 km/s but still takes 8 min 20 sec to reach us!"},
    {q:"Which planet rotates on its side?",a:"d",o:["Neptune","Saturn","Mars","Uranus"],f:"Uranus has a 98¬∞ axial tilt ‚Äî a massive collision knocked it sideways!"},
    {q:"Hottest planet in our solar system?",a:"b",o:["Mercury","Venus","Mars","Jupiter"],f:"Venus is hotter than Mercury ‚Äî its thick atmosphere traps heat like a greenhouse!"},
    {q:"How old is our solar system?",a:"c",o:["1 billion","3 billion","4.6 billion years","10 billion"],f:"Our solar system formed from a giant cloud of gas and dust 4.6 billion years ago!"},
    {q:"What is Jupiter's Great Red Spot?",a:"a",o:["A storm","A volcano","A crater","A sea"],f:"The Great Red Spot has been raging for 350+ years and is wider than Earth!"},
    {q:"Which planet has a day longer than its year?",a:"b",o:["Mercury","Venus","Mars","Jupiter"],f:"Venus takes 243 Earth days to rotate but only 225 days to orbit the Sun!"},
    {q:"Neptune's orbital period around the Sun?",a:"c",o:["84 years","60 years","165 years","248 years"],f:"Neptune has completed only ONE orbit since it was discovered in 1846!"},
    {q:"What is the Milky Way?",a:"d",o:["A star cluster","A nebula","A black hole","Our galaxy"],f:"The Milky Way contains 100‚Äì400 billion stars ‚Äî our Sun is just one of them!"},
    {q:"How many moons does Mars have?",a:"b",o:["0","2","4","1"],f:"Mars has two small moons ‚Äî Phobos and Deimos ‚Äî both likely captured asteroids!"},
    {q:"What is the largest planet in our solar system?",a:"a",o:["Jupiter","Saturn","Uranus","Neptune"],f:"Jupiter is so large that all other planets could fit inside it with room to spare!"},
  ],
  records:[
    {q:"Which country borders the most other countries?",a:"b",o:["USA","China","Russia","Brazil"],f:"China AND Russia both border 14 countries ‚Äî joint record holders!"},
    {q:"Most spoken language by native speakers?",a:"a",o:["Mandarin Chinese","English","Spanish","Hindi"],f:"Mandarin has ~920 million native speakers ‚Äî ~12% of the world's population!"},
    {q:"World's most densely populated country?",a:"b",o:["Singapore","Monaco","Vatican City","Bangladesh"],f:"Monaco packs ~19,000 people per km¬≤ into just 2 km¬≤ of land!"},
    {q:"Most visited country in the world?",a:"d",o:["USA","Spain","Italy","France"],f:"France receives ~90 million international tourists per year!"},
    {q:"Which country has the most official languages?",a:"b",o:["India","Zimbabwe","South Africa","Switzerland"],f:"Zimbabwe has 16 official languages ‚Äî the most of any country!"},
    {q:"World's tallest waterfall?",a:"c",o:["Niagara","Iguazu","Angel Falls","Victoria"],f:"Angel Falls in Venezuela drops 979m ‚Äî water often evaporates before reaching the bottom!"},
    {q:"Largest island in the world?",a:"b",o:["Borneo","Greenland","New Guinea","Madagascar"],f:"Greenland covers 2.16 million km¬≤ though 80% is covered by ice!"},
    {q:"Country that produces the most coffee?",a:"a",o:["Brazil","Colombia","Vietnam","Ethiopia"],f:"Brazil produces ~37% of the world's coffee and has for over 150 years!"},
    {q:"Which city has the most skyscrapers?",a:"d",o:["New York","Dubai","Shanghai","Hong Kong"],f:"Hong Kong has more buildings over 150m than any other city in the world!"},
    {q:"Which country has the most UNESCO World Heritage Sites?",a:"c",o:["China","France","Italy","Spain"],f:"Italy leads with 58 UNESCO World Heritage Sites as of 2023!"},
  ],
  flags:[
    {q:"Which country's flag has a maple leaf?",a:"a",o:["Canada","Australia","New Zealand","Jamaica"],f:"Canada adopted the maple leaf flag in 1965, replacing the design with the Union Jack!"},
    {q:"Only country with a non-rectangular flag?",a:"c",o:["Bangladesh","Switzerland","Nepal","Vatican City"],f:"Nepal's double pennon shape makes it the only non-quadrilateral national flag!"},
    {q:"Which flag features a dragon?",a:"d",o:["China","Vietnam","South Korea","Bhutan"],f:"Bhutan's Druk (thunder dragon) flag ‚Äî Bhutan means 'Land of the Thunder Dragon'!"},
    {q:"World's oldest unchanged national flag?",a:"b",o:["France","Denmark","Netherlands","Sweden"],f:"Denmark's Dannebrog dates to 1370 ‚Äî the world's oldest continuously used national flag!"},
    {q:"Which flags are completely square?",a:"d",o:["USA & Canada","France & Italy","Germany & Austria","Switzerland & Vatican City"],f:"Switzerland and Vatican City are the only two countries with perfectly square flags!"},
    {q:"Which country's flag has a cedar tree?",a:"c",o:["Jordan","Saudi Arabia","Lebanon","Syria"],f:"The Cedar of Lebanon has been a national symbol for thousands of years!"},
    {q:"Which flag has the Southern Cross constellation?",a:"a",o:["Australia","Argentina","Colombia","Chile"],f:"Australia, NZ, Papua New Guinea, Samoa & Brazil all feature the Southern Cross!"},
    {q:"Which country's flag is red with a yellow star?",a:"b",o:["Vietnam","China","North Korea","Laos"],f:"China's flag has one large and four small stars ‚Äî the large one represents the Communist Party!"},
  ],
  oceans:[
    {q:"How many oceans are officially recognised?",a:"c",o:["4","3","5","6"],f:"The Southern Ocean was officially recognised as the 5th ocean by National Geographic in 2021!"},
    {q:"Which ocean is the saltiest?",a:"a",o:["Atlantic","Pacific","Indian","Arctic"],f:"The Atlantic has higher salt content due to more evaporation and fewer rivers!"},
    {q:"What is the Great Barrier Reef?",a:"d",o:["A mountain range","A river delta","An island chain","World's largest coral reef"],f:"The Great Barrier Reef is visible from space and is Earth's largest living structure!"},
    {q:"Which ocean current keeps Europe warm?",a:"b",o:["California Current","Gulf Stream","Kuroshio","Humboldt"],f:"The Gulf Stream brings warm water from the Gulf of Mexico all the way to Europe!"},
    {q:"Which sea has no coastline?",a:"a",o:["Sargasso Sea","Dead Sea","Red Sea","Arabian Sea"],f:"The Sargasso Sea is unique ‚Äî defined entirely by ocean currents, not coastlines!"},
    {q:"Average depth of the world's oceans?",a:"d",o:["1,200m","1,800m","2,500m","3,688m"],f:"If ocean water was spread evenly over Earth, it would be 2.7km deep everywhere!"},
    {q:"Which is the smallest ocean?",a:"c",o:["Indian","Southern","Arctic","Atlantic"],f:"The Arctic Ocean covers ~14 million km¬≤ ‚Äî about 1.5 times the size of the USA!"},
  ]
};

// ‚îÄ‚îÄ CONTINENTS DATA ‚îÄ‚îÄ
const CONTS=[
  {id:'africa',name:'Africa',emoji:'üåç',color:'#f97316',desc:'54 countries ¬∑ 5 minutes',time:300,
   countries:['Algeria','Angola','Benin','Botswana','Burkina Faso','Burundi','Cabo Verde','Cameroon','Central African Republic','Chad','Comoros','Democratic Republic of Congo','Republic of Congo','Djibouti','Egypt','Equatorial Guinea','Eritrea','Eswatini','Ethiopia','Gabon','Gambia','Ghana','Guinea','Guinea-Bissau','Ivory Coast','Kenya','Lesotho','Liberia','Libya','Madagascar','Malawi','Mali','Mauritania','Mauritius','Morocco','Mozambique','Namibia','Niger','Nigeria','Rwanda','Sao Tome and Principe','Senegal','Seychelles','Sierra Leone','Somalia','South Africa','South Sudan','Sudan','Tanzania','Togo','Tunisia','Uganda','Zambia','Zimbabwe']},
  {id:'europe',name:'Europe',emoji:'üá™üá∫',color:'#3b82f6',desc:'44 countries ¬∑ 4 minutes',time:240,
   countries:['Albania','Andorra','Austria','Belarus','Belgium','Bosnia and Herzegovina','Bulgaria','Croatia','Cyprus','Czech Republic','Denmark','Estonia','Finland','France','Germany','Greece','Hungary','Iceland','Ireland','Italy','Kosovo','Latvia','Liechtenstein','Lithuania','Luxembourg','Malta','Moldova','Monaco','Montenegro','Netherlands','North Macedonia','Norway','Poland','Portugal','Romania','Russia','San Marino','Serbia','Slovakia','Slovenia','Spain','Sweden','Switzerland','Ukraine','United Kingdom','Vatican City']},
  {id:'asia',name:'Asia',emoji:'üåè',color:'#a78bfa',desc:'48 countries ¬∑ 5 minutes',time:300,
   countries:['Afghanistan','Armenia','Azerbaijan','Bahrain','Bangladesh','Bhutan','Brunei','Cambodia','China','Cyprus','Georgia','India','Indonesia','Iran','Iraq','Israel','Japan','Jordan','Kazakhstan','Kuwait','Kyrgyzstan','Laos','Lebanon','Malaysia','Maldives','Mongolia','Myanmar','Nepal','North Korea','Oman','Pakistan','Palestine','Philippines','Qatar','Saudi Arabia','Singapore','South Korea','Sri Lanka','Syria','Taiwan','Tajikistan','Thailand','Timor-Leste','Turkey','Turkmenistan','United Arab Emirates','Uzbekistan','Vietnam','Yemen']},
  {id:'americas',name:'Americas',emoji:'üåé',color:'#06ffa5',desc:'35 countries ¬∑ 4 minutes',time:240,
   countries:['Antigua and Barbuda','Argentina','Bahamas','Barbados','Belize','Bolivia','Brazil','Canada','Chile','Colombia','Costa Rica','Cuba','Dominica','Dominican Republic','Ecuador','El Salvador','Grenada','Guatemala','Guyana','Haiti','Honduras','Jamaica','Mexico','Nicaragua','Panama','Paraguay','Peru','Saint Kitts and Nevis','Saint Lucia','Saint Vincent and the Grenadines','Suriname','Trinidad and Tobago','United States','Uruguay','Venezuela']},
  {id:'oceania',name:'Oceania',emoji:'üèùÔ∏è',color:'#ffd166',desc:'14 countries ¬∑ 3 minutes',time:180,
   countries:['Australia','Fiji','Kiribati','Marshall Islands','Micronesia','Nauru','New Zealand','Palau','Papua New Guinea','Samoa','Solomon Islands','Tonga','Tuvalu','Vanuatu']},
  {id:'middleeast',name:'Middle East',emoji:'üïå',color:'#ff6b6b',desc:'18 countries ¬∑ 3 minutes',time:180,
   countries:['Bahrain','Egypt','Iran','Iraq','Israel','Jordan','Kuwait','Lebanon','Libya','Oman','Palestine','Qatar','Saudi Arabia','Syria','Turkey','United Arab Emirates','Yemen','Cyprus']},
];

const CATS_LIST=[
  {id:'capitals',name:'World Capitals',icon:'üèõÔ∏è',color:'#00d4c8'},
  {id:'geography',name:'Geography Facts',icon:'üåç',color:'#ffd166'},
  {id:'solar',name:'Solar System',icon:'ü™ê',color:'#a78bfa'},
  {id:'records',name:'World Records',icon:'üèÜ',color:'#f97316'},
  {id:'flags',name:'Country Flags',icon:'üö©',color:'#ec4899'},
  {id:'oceans',name:'Oceans & Seas',icon:'üåä',color:'#3b82f6'},
];

// ‚îÄ‚îÄ STATE ‚îÄ‚îÄ
let player=JSON.parse(localStorage.getItem('gqp')||'null');
let quiz={}, cq={}, cqInt=null, qInt=null, lastCat=null;

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
window.addEventListener('load',()=>{
  renderCats(); renderConts(); setupDaily();
  if(player) updateAuthUI();
  loadStats(); loadLeaderboard();
});

function renderCats(){
  document.getElementById('cats-grid').innerHTML=CATS_LIST.map(c=>`
    <div class="cat-card" style="--cc2:${c.color}" onclick="startQuiz('${c.id}')">
      <div class="cat-icon-w">${c.icon}</div>
      <div class="cat-name">${c.name}</div>
      <div class="cat-count">${Q[c.id].length} questions</div>
    </div>`).join('');
}

function renderConts(){
  document.getElementById('conts-grid').innerHTML=CONTS.map(c=>`
    <div class="cont-card" style="--cc:${c.color}" onclick="startCQ('${c.id}')">
      <span class="cont-emoji">${c.emoji}</span>
      <div class="cont-name">${c.name}</div>
      <div class="cont-stats">${c.desc}</div>
      <span class="cont-tag">Name all countries ‚Üí</span>
    </div>`).join('');
}

function setupDaily(){
  const themes=['üåç African Geography','ü™ê Space Exploration','üåä Oceans & Islands','üèîÔ∏è Mountains & Borders','üö© Flags of the World','üèÜ World Records','üó∫Ô∏è Asian Capitals'];
  document.getElementById('daily-theme').textContent=themes[new Date().getDay()];
}

// ‚îÄ‚îÄ CONTINENT QUIZ ‚îÄ‚îÄ
function startCQ(id){
  const cont=CONTS.find(c=>c.id===id);
  cq={cont,found:[],score:0,timeLeft:cont.time,done:false};
  document.getElementById('cq-emoji').textContent=cont.emoji;
  document.getElementById('cq-title').textContent=cont.name;
  document.getElementById('cq-sub').textContent=`Name all ${cont.countries.length} countries`;
  document.getElementById('found-tags').innerHTML='';
  document.getElementById('missed-box').style.display='none';
  document.getElementById('cq-input').value='';
  document.getElementById('cq-input').disabled=false;
  updateCQProg();
  showScreen('continent');
  clearInterval(cqInt);
  cqInt=setInterval(()=>{cq.timeLeft--;updateCQTimer();if(cq.timeLeft<=0){clearInterval(cqInt);endCQ();}},1000);
  setTimeout(()=>document.getElementById('cq-input').focus(),300);
}

function updateCQTimer(){
  const m=Math.floor(cq.timeLeft/60),s=(cq.timeLeft%60).toString().padStart(2,'0');
  const el=document.getElementById('cq-timer');
  el.textContent=`${m}:${s}`;
  el.className='cq-timer-big'+(cq.timeLeft<=30?' urgent':'');
}

function updateCQProg(){
  const f=cq.found.length,t=cq.cont.countries.length;
  document.getElementById('cq-count').textContent=`${f} / ${t}`;
  document.getElementById('cq-bar').style.width=`${(f/t)*100}%`;
}

function submitCountry(){
  const inp=document.getElementById('cq-input');
  const val=inp.value.trim(); if(!val) return;
  const norm=val.toLowerCase().replace(/[^a-z\s]/g,'');
  const match=cq.cont.countries.find(c=>{
    const cn=c.toLowerCase().replace(/[^a-z\s]/g,'');
    return cn===norm||(cn.includes(norm)&&norm.length>3)||(norm.includes(cn)&&cn.length>4);
  });
  if(!match){showToast('Not found ‚Äî try again!','error');inp.select();return;}
  if(cq.found.includes(match)){showToast('Already found!','info');inp.value='';return;}
  cq.found.push(match);
  const pts=Math.max(50,cq.timeLeft*2); cq.score+=pts;
  const tag=document.createElement('div'); tag.className='found-tag'; tag.textContent=match;
  document.getElementById('found-tags').appendChild(tag);
  updateCQProg(); spawnParticles(inp);
  showToast(`‚úì ${match}! +${pts}pts`,'success');
  inp.value='';
  if(cq.found.length===cq.cont.countries.length){clearInterval(cqInt);setTimeout(()=>endCQ(true),500);}
}

function giveHint(){
  const rem=cq.cont.countries.filter(c=>!cq.found.includes(c));
  if(!rem.length) return;
  const h=rem[Math.floor(Math.random()*rem.length)];
  cq.score=Math.max(0,cq.score-50);
  showToast(`üí° Starts with "${h.substring(0,3)}..."`, 'info');
}

function giveUp(){clearInterval(cqInt);endCQ(false);}

function endCQ(perfect=false){
  cq.done=true;
  document.getElementById('cq-input').disabled=true;
  const rem=cq.cont.countries.filter(c=>!cq.found.includes(c));
  if(rem.length){
    document.getElementById('missed-box').style.display='block';
    document.getElementById('missed-tags').innerHTML=rem.map(c=>`<span class="missed-tag">${c}</span>`).join('');
  }
  const pct=cq.found.length/cq.cont.countries.length;
  const msg=perfect?'üéâ Perfect! You found them all!':pct>.8?'üåü Excellent!':pct>.5?'üëç Good work!':'üìö Keep exploring!';
  showToast(msg,'success');
}

// ‚îÄ‚îÄ TRIVIA QUIZ ‚îÄ‚îÄ
function startQuiz(catId){
  lastCat=catId;
  const qs=[...Q[catId]].sort(()=>Math.random()-.5).slice(0,10);
  const cat=CATS_LIST.find(c=>c.id===catId);
  quiz={qs,cur:0,score:0,correct:0,catName:cat.name,catIcon:cat.icon,times:[]};
  document.getElementById('q-cat').textContent=`${cat.icon} ${cat.name}`;
  showScreen('quiz'); loadQ();
}

function startDailyChallenge(){
  const all=Object.values(Q).flat();
  const qs=all.sort(()=>Math.random()-.5).slice(0,10);
  quiz={qs,cur:0,score:0,correct:0,catName:'Daily Challenge',catIcon:'‚ö°',times:[]};
  document.getElementById('q-cat').textContent='‚ö° Daily Challenge';
  showScreen('quiz'); loadQ();
}

function loadQ(){
  const {qs,cur}=quiz; if(cur>=qs.length){endQuiz();return;}
  const q=qs[cur];
  document.getElementById('q-prog').style.width=`${(cur/qs.length)*100}%`;
  document.getElementById('q-num').textContent=`Question ${cur+1} of ${qs.length}`;
  document.getElementById('q-text').textContent=q.q;
  document.getElementById('fact-box').classList.remove('show');
  document.getElementById('next-btn').style.display='none';
  const L=['A','B','C','D'];
  document.getElementById('opts-grid').innerHTML=q.o.map((opt,i)=>`
    <button class="opt-btn" onclick="selectA('${'abcd'[i]}',this)">
      <span class="opt-letter">${L[i]}</span>${opt}
    </button>`).join('');
  startQTimer();
}

function startQTimer(){
  clearInterval(qInt); let t=20;
  const el=document.getElementById('q-timer'); el.textContent=t; el.className='q-timer';
  qInt=setInterval(()=>{t--;el.textContent=t;if(t<=5)el.className='q-timer urgent';if(t<=0){clearInterval(qInt);qTimeout();}},1000);
}

function qTimeout(){
  const q=quiz.qs[quiz.cur];
  document.querySelectorAll('.opt-btn').forEach(b=>b.disabled=true);
  document.querySelectorAll('.opt-btn')['abcd'.indexOf(q.a)].classList.add('correct');
  showFact(q.f); document.getElementById('next-btn').style.display='inline-block'; quiz.times.push(20);
}

function selectA(ans,btn){
  clearInterval(qInt);
  const taken=20-parseInt(document.getElementById('q-timer').textContent); quiz.times.push(taken);
  const q=quiz.qs[quiz.cur];
  document.querySelectorAll('.opt-btn').forEach(b=>b.disabled=true);
  document.querySelectorAll('.opt-btn')['abcd'.indexOf(q.a)].classList.add('correct');
  if(ans===q.a){quiz.correct++;const pts=Math.max(10,20-taken)*5;quiz.score+=pts;spawnParticles(btn);showToast(`‚úì Correct! +${pts}pts`,'success');}
  else{btn.classList.add('wrong');showToast('‚úó Not quite!','error');}
  showFact(q.f); document.getElementById('next-btn').style.display='inline-block';
}

function showFact(f){if(!f)return;document.getElementById('fact-text').textContent=f;document.getElementById('fact-box').classList.add('show');}
function nextQ(){quiz.cur++;loadQ();}
function exitQuiz(){clearInterval(qInt);showScreen('home');}
function playAgain(){if(lastCat)startQuiz(lastCat);else showScreen('home');}

function endQuiz(){
  clearInterval(qInt);
  const {score,correct,qs,times}=quiz;
  const wrong=qs.length-correct;
  const avg=Math.round(times.reduce((a,b)=>a+b,0)/times.length);
  const pct=Math.round(correct/qs.length*100);
  document.getElementById('res-pts').textContent=score;
  document.getElementById('res-correct').textContent=correct;
  document.getElementById('res-wrong').textContent=wrong;
  document.getElementById('res-avg').textContent=avg+'s';
  const titles=['Keep going! üå±','Nice try! üåç','Great work! üåü','Impressive! üèÜ','Geography Master! üëë'];
  document.getElementById('res-title').textContent=titles[Math.min(Math.floor(pct/25),4)];
  document.getElementById('res-sub').textContent=`${correct} out of ${qs.length} correct ‚Äî ${pct}%`;
  setTimeout(()=>{const off=528-(528*pct/100);const arc=document.getElementById('score-arc');arc.style.transition='stroke-dashoffset 1.2s cubic-bezier(0.23,1,0.32,1)';arc.style.strokeDashoffset=off;},200);
  showScreen('results');
  if(player) saveScore(score,correct);
}

// ‚îÄ‚îÄ DATABASE ‚îÄ‚îÄ
async function saveScore(score,correct){
  try{
    await db.post('quiz_sessions',{player_id:player.id,category:quiz.catName,score,correct_answers:correct,total_questions:quiz.qs.length});
    const lb=await db.get('leaderboard',`player_id=eq.${player.id}`);
    if(lb&&lb[0]){await db.patch('leaderboard',lb[0].id,{total_score:(lb[0].total_score||0)+score,quizzes_played:(lb[0].quizzes_played||0)+1,username:player.username,country:player.country,last_played:new Date().toISOString()});}
    else{await db.post('leaderboard',{player_id:player.id,username:player.username,country:player.country,total_score:score,quizzes_played:1});}
    loadStats(); loadLeaderboard();
  }catch(e){console.log(e);}
}

async function loadStats(){
  if(!player)return;
  try{
    const lb=await db.get('leaderboard',`player_id=eq.${player.id}`);
    if(lb&&lb[0]){document.getElementById('stat-played').textContent=lb[0].quizzes_played||0;document.getElementById('stat-score').textContent=(lb[0].total_score||0).toLocaleString();}
    const all=await db.get('leaderboard','order=total_score.desc');
    const rank=all.findIndex(p=>p.player_id===player.id)+1;
    if(rank>0)document.getElementById('stat-rank').textContent='#'+rank;
  }catch(e){}
}

async function loadLeaderboard(){
  try{
    const data=await db.get('leaderboard','order=total_score.desc&limit=20');
    const flags={IS:'üáÆüá∏',CH:'üá®üá≠',US:'üá∫üá∏',GB:'üá¨üáß',NO:'üá≥üá¥',SE:'üá∏üá™',DK:'üá©üá∞',FI:'üá´üáÆ',DE:'üá©üá™',FR:'üá´üá∑',IT:'üáÆüáπ',AT:'üá¶üáπ'};
    const medals=['ü•á','ü•à','ü•â'];
    if(!data||!data.length){document.getElementById('lb-list').innerHTML=`<div class="empty-state"><div class="ei">üèÜ</div><p>No scores yet ‚Äî be the first!</p></div>`;return;}
    document.getElementById('lb-list').innerHTML=data.map((p,i)=>`
      <div class="lb-item${player&&p.player_id===player.id?' me':''}">
        <div class="lb-rank ${i<3?'r'+(i+1):''}">${i<3?medals[i]:i+1}</div>
        <div class="lb-avatar">${flags[p.country]||'üåç'}</div>
        <div class="lb-info"><div class="lb-name">${p.username||'Explorer'}${player&&p.player_id===player.id?' (you)':''}</div><div class="lb-country">${p.country||'World'}</div></div>
        <div><div class="lb-pts">${(p.total_score||0).toLocaleString()}</div><div class="lb-games">${p.quizzes_played||0} quizzes</div></div>
      </div>`).join('');
  }catch(e){document.getElementById('lb-list').innerHTML=`<div class="empty-state"><div class="ei">üåç</div><p>Loading...</p></div>`;}
}

// ‚îÄ‚îÄ AUTH ‚îÄ‚îÄ
function showLogin(){if(player){showToast('Signed in as '+player.username,'info');return;}document.getElementById('login-modal').classList.add('show');}
function closeModal(){document.getElementById('login-modal').classList.remove('show');}

async function createPlayer(){
  const u=document.getElementById('inp-user').value.trim();
  const e=document.getElementById('inp-email').value.trim();
  const c=document.getElementById('inp-country').value;
  if(!u){showToast('Please enter a username','error');return;}
  try{
    const r=await db.post('players',{username:u,email:e||null,country:c||'Other'});
    if(r&&r[0]){player=r[0];localStorage.setItem('gqp',JSON.stringify(player));updateAuthUI();closeModal();showToast(`Welcome, ${u}! üåç`,'success');loadStats();}
    else{showToast('Username taken ‚Äî try another!','error');}
  }catch(e){showToast('Error creating profile','error');}
}

function updateAuthUI(){
  if(!player)return;
  const btn=document.getElementById('auth-btn');
  btn.textContent=player.username;
  btn.style.cssText='background:rgba(0,212,200,0.1);color:var(--teal);border:1px solid rgba(0,212,200,0.2);padding:9px 22px;border-radius:50px;font-family:Inter,sans-serif;font-size:0.875rem;font-weight:600;cursor:pointer;';
  document.getElementById('streak-pill').style.display='flex';
}

// ‚îÄ‚îÄ PARTICLES ‚îÄ‚îÄ
function spawnParticles(el){
  const r=el.getBoundingClientRect(),cx=r.left+r.width/2,cy=r.top+r.height/2;
  const cols=['#00d4c8','#ffd166','#06ffa5','#a78bfa','#ff6b6b'];
  for(let i=0;i<18;i++){
    const p=document.createElement('div'); p.className='particle';
    const sz=Math.random()*8+4,ang=Math.random()*360,dist=Math.random()*120+60;
    const tx=Math.cos(ang*Math.PI/180)*dist,ty=Math.sin(ang*Math.PI/180)*dist-60;
    p.style.cssText=`left:${cx}px;top:${cy}px;width:${sz}px;height:${sz}px;background:${cols[Math.floor(Math.random()*cols.length)]};--tx:${tx}px;--ty:${ty}px;animation-duration:${Math.random()*.4+.6}s;`;
    document.body.appendChild(p); setTimeout(()=>p.remove(),1100);
  }
}

// ‚îÄ‚îÄ NAV ‚îÄ‚îÄ
function showScreen(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById('screen-'+id).classList.add('active');
  document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
  const nb=document.getElementById('nav-'+id); if(nb)nb.classList.add('active');
  window.scrollTo(0,0);
  if(id==='leaderboard')loadLeaderboard();
}

// ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ
function showToast(msg,type=''){
  const t=document.getElementById('toast'); t.textContent=msg; t.className=`toast ${type} show`;
  setTimeout(()=>t.classList.remove('show'),2500);
}
</script>
</body>
</html>
